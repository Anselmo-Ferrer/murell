// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String
  password      String
  avatar        String?
  bio           String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  boards        BoardMember[]
  createdBoards Board[]    @relation("BoardCreator")
  comments      Comment[]
  cardLikes     CardLike[]
  cardMembers   CardMember[]
  notifications Notification[]

  @@map("users")
}

model Board {
  id          String   @id @default(cuid())
  title       String
  description String?
  color       String   @default("gray")
  category    String?  // 'recently-viewed' | 'new' | 'process' | 'completed'
  isPublic    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  creatorId   String
  creator     User     @relation("BoardCreator", fields: [creatorId], references: [id], onDelete: Cascade)
  members     BoardMember[]
  columns     Column[]

  @@map("boards")
}

model BoardMember {
  id        String   @id @default(cuid())
  role      String   @default("member") // 'owner' | 'admin' | 'member'
  joinedAt  DateTime @default(now())

  // Relations
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  boardId   String
  board     Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)

  @@unique([userId, boardId])
  @@map("board_members")
}

model Column {
  id          String   @id @default(cuid())
  title       String
  position    Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  boardId     String
  board       Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)
  cards       Card[]

  @@map("columns")
}

model Card {
  id          String   @id @default(cuid())
  title       String
  description String?
  image       String?
  position    Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  columnId    String
  column      Column   @relation(fields: [columnId], references: [id], onDelete: Cascade)
  labels      CardLabel[]
  members     CardMember[]
  comments    Comment[]
  likes       CardLike[]
  attachments Attachment[]

  @@map("cards")
}

model Label {
  id        String   @id @default(cuid())
  name      String
  color     String   // 'purple' | 'red' | 'pink' | 'cyan' | 'green' | 'yellow' | 'blue'
  createdAt DateTime @default(now())

  // Relations
  cards     CardLabel[]

  @@unique([name, color])
  @@map("labels")
}

model CardLabel {
  id      String @id @default(cuid())
  cardId  String
  card    Card   @relation(fields: [cardId], references: [id], onDelete: Cascade)
  labelId String
  label   Label  @relation(fields: [labelId], references: [id], onDelete: Cascade)

  @@unique([cardId, labelId])
  @@map("card_labels")
}

model CardMember {
  id     String @id @default(cuid())
  cardId String
  card   Card   @relation(fields: [cardId], references: [id], onDelete: Cascade)
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([cardId, userId])
  @@map("card_members")
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  cardId    String
  card      Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("comments")
}

model CardLike {
  id     String   @id @default(cuid())
  cardId String
  card   Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)
  userId String
  user   User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([cardId, userId])
  @@map("card_likes")
}

model Attachment {
  id        String   @id @default(cuid())
  filename  String
  url       String
  mimeType  String?
  size      Int?
  createdAt DateTime @default(now())

  // Relations
  cardId    String
  card      Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@map("attachments")
}

model Notification {
  id        String   @id @default(cuid())
  type      String   // 'board_invite' | 'card_assigned' | 'comment' | 'mention'
  title     String
  message   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())

  // Relations
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

